/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => KindleCsvPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian7 = require("obsidian");

// src/settings.ts
var import_obsidian = require("obsidian");
var import_obsidian2 = require("obsidian");
var import_obsidian3 = require("obsidian");
var DEFAULT_SETTINGS = {
  path: "/",
  separator: "_",
  iframe: true,
  highlight: "*** \\n \\n > [!quote] location \\n *highlight* \\n \\n",
  note: "**Note** \\n > note \\n \\n"
};
var KindleSettings = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    let { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h3", { text: "Settings: Kindle CSV Converter" });
    new import_obsidian2.Setting(containerEl).setName("Path for saving").setDesc("This is the path were your notes will be saved.").addDropdown((dropdown) => {
      let folders = [];
      for (let file of this.app.vault.getAllLoadedFiles()) {
        if (file instanceof import_obsidian3.TFolder) {
          folders.push(file);
        }
      }
      folders.forEach(function(value) {
        dropdown.addOption(value["path"], value["path"]);
      });
      dropdown.setValue(this.plugin.settings.path).onChange(async (value) => {
        this.plugin.settings.path = value;
        await this.plugin.saveSettings();
      });
    });
    new import_obsidian2.Setting(containerEl).setName("Separator").setDesc('This is how the file name will be formatted. Example: "Title of my book" is going to be "Title_of_my_book".').addText((text) => text.setPlaceholder('Default is "_"').setValue(this.plugin.settings.separator).onChange(async (value) => {
      this.plugin.settings.separator = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("Show iframe").setDesc("Shows additional information of your Kindle book.").addToggle((text) => text.setValue(this.plugin.settings.iframe).onChange(async (value) => {
      this.plugin.settings.iframe = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("Highlight").setDesc(`This represents how the highlight will be formatted. Default: ${DEFAULT_SETTINGS["highlight"]}`).addText((text) => text.setValue(this.plugin.settings.highlight).onChange(async (value) => {
      this.plugin.settings.highlight = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian2.Setting(containerEl).setName("Note").setDesc(`This represents how the note will be formatted. Default: ${DEFAULT_SETTINGS["note"]}`).addText((text) => text.setValue(this.plugin.settings.note).onChange(async (value) => {
      this.plugin.settings.note = value;
      await this.plugin.saveSettings();
    }));
    containerEl.createEl("h3", { text: "Support me!" });
    const div = this.containerEl.createDiv("coffee");
    div.createEl("a", {
      href: "https://www.buymeacoffee.com/alvaro.cas"
    }).createEl("img", {
      attr: {
        src: "https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&emoji=\u2615&slug=alvaro.cas&button_colour=FFDD00&font_colour=000000&font_family=Inter&outline_colour=000000&coffee_colour=ffffff"
      }
    });
  }
};

// src/modal_read.ts
var import_obsidian4 = require("obsidian");
var import_obsidian5 = require("obsidian");
var import_obsidian6 = require("obsidian");
var fs = require("fs");
var readline = require("readline");
var Reader = class extends import_obsidian4.Modal {
  constructor(app, settings) {
    super(app);
    this.settings = settings;
  }
  onOpen() {
    let { contentEl } = this;
    contentEl.createEl("h2", { text: "Kindle CSV to Obsidian", cls: "h-modal" });
    const divMain = contentEl.createDiv({ cls: "main-div" });
    const divIcon = divMain.createDiv({ cls: "file-up-div" });
    (0, import_obsidian6.setIcon)(divIcon, "file-up");
    divIcon.createEl("div", { text: "Choose your file", cls: "div-modal" });
    divIcon.onclick = (_this) => {
      this.createFile();
    };
  }
  onClose() {
    let { contentEl } = this;
    contentEl.empty();
  }
  createFile() {
    let input = activeDocument.createElement("input");
    input.type = "file";
    input.accept = ".csv";
    input.onchange = (_this) => {
      const stream = fs.createReadStream(input.files[0]["path"]);
      const reader = readline.createInterface({ input: stream });
      let data = [];
      reader.on("line", (row) => {
        let line = row.split(",");
        let result = line.splice(0, 3);
        result.push(line.join(","));
        data.push(result);
      });
      reader.on("close", () => {
        let name = data[1][0].replace(/[&\/\\#,+()$~%.'":*?<>{}]/g, "");
        name = name.replace(/ /g, this.settings.separator);
        let markdown;
        if (this.settings.iframe == true) {
          markdown = `
<iframe
           height=600px
           width=100%
           src=${data[4][0]}></iframe> 
`;
        } else {
          markdown = `${data[0][0].replace(/"/g, "")} ${data[1][0].replace(/"/g, "")} ${data[2][0].replace(/"/g, "")} 
`;
        }
        for (let i = 8; i < data.length; i++) {
          if (data[i][0] == '"Note"') {
            let note = this.settings.note.replace("note", data[i][3].replace(/"/g, ""));
            note = note.replace(/\\n/g, "\n");
            markdown += note;
          } else {
            let highlight = this.settings.highlight.replace("highlight", data[i][3]);
            highlight = highlight.replace(/\\n/g, "\n");
            highlight = highlight.replace("location", data[i][1].replace(/"/g, ""));
            markdown += highlight;
          }
        }
        this.app.vault.create(`${this.settings.path}/${name}.md`, markdown).then(() => {
          new import_obsidian5.Notice(`Your notes were succesfully created.                      Path: ${this.settings.path}`);
        }).catch((err) => {
          console.log(err);
          new import_obsidian5.Notice("File already exists. Please delete and try again.");
        });
      });
    };
    input.click();
    this.close();
  }
};

// main.ts
var KindleCsvPlugin = class extends import_obsidian7.Plugin {
  async onload() {
    await this.loadSettings();
    this.addRibbonIcon("library", "Kindle CSV Converter", () => {
      new Reader(this.app, this.settings).open();
    });
    this.addCommand({
      id: "choose-file",
      name: "Choose File",
      checkCallback: (checking) => {
        const view = this.app.workspace.getActiveViewOfType(MarkdownView);
        if (view) {
          if (!checking) {
            new Reader(this.app, this.settings).open();
          }
          return true;
        }
        return false;
      }
    });
    this.addSettingTab(new KindleSettings(this.app, this));
  }
  onunload() {
    console.log("unloading plugin");
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJzcmMvc2V0dGluZ3MudHMiLCAic3JjL21vZGFsX3JlYWQudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IEFwcCB9IGZyb20gJ29ic2lkaWFuJztcclxuaW1wb3J0IHsgUGx1Z2luIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5cclxuaW1wb3J0IHsgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gJy4vc3JjL3NldHRpbmdzJztcclxuaW1wb3J0IHsgS2luZGxlU2V0dGluZ3MgfSBmcm9tICcuL3NyYy9zZXR0aW5ncyc7XHJcbmltcG9ydCB7IFJlYWRlciB9IGZyb20gJy4vc3JjL21vZGFsX3JlYWQnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgS2luZGxlQ3N2UGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcclxuICBhc3luYyBvbmxvYWQoKSB7XHJcbiAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xyXG5cclxuICAgIHRoaXMuYWRkUmliYm9uSWNvbihcImxpYnJhcnlcIiwgXCJLaW5kbGUgQ1NWIENvbnZlcnRlclwiLCAoKSA9PiB7XHJcbiAgICAgIG5ldyBSZWFkZXIodGhpcy5hcHAsIHRoaXMuc2V0dGluZ3MpLm9wZW4oKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuYWRkQ29tbWFuZCh7XHJcbiAgICAgIGlkOiAnY2hvb3NlLWZpbGUnLFxyXG4gICAgICBuYW1lOiAnQ2hvb3NlIEZpbGUnLFxyXG4gICAgICBjaGVja0NhbGxiYWNrOiAoY2hlY2tpbmc6IGJvb2xlYW4pID0+IHtcclxuICAgICAgICBjb25zdCB2aWV3ID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KTtcclxuICAgICAgICBpZiAodmlldykge1xyXG4gICAgICAgICAgaWYgKCFjaGVja2luZykge1xyXG4gICAgICAgICAgICBuZXcgUmVhZGVyKHRoaXMuYXBwLCB0aGlzLnNldHRpbmdzKS5vcGVuKCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgS2luZGxlU2V0dGluZ3ModGhpcy5hcHAsIHRoaXMpKTtcclxuXHJcbiAgfVxyXG5cclxuICBvbnVubG9hZCgpIHtcclxuICAgIGNvbnNvbGUubG9nKCd1bmxvYWRpbmcgcGx1Z2luJyk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XHJcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcclxuICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XHJcbiAgfVxyXG59XHJcbiIsICJpbXBvcnQgeyBQbHVnaW5TZXR0aW5nVGFiIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgU2V0dGluZyB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IFRGb2xkZXIgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgUmVhZGVyIH0gZnJvbSAnLi9tb2RhbF9yZWFkJztcblxubGV0IHJpYmJvbktpbmRsZSA9IG51bGw7XG5cbmludGVyZmFjZSBLaW5kbGVDc3ZQbHVnaW5TZXR0aW5ncyB7XG4gIHBhdGg6IHN0cmluZ1xuICBzZXBhcmF0b3I6IHN0cmluZ1xuICBpZnJhbWU6IGJvb2xlYW5cbiAgaGlnaGxpZ2h0OiBzdHJpbmdcbiAgbm90ZTogc3RyaW5nXG59XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFVFRJTkdTOiBLaW5kbGVDc3ZQbHVnaW5TZXR0aW5ncyA9IHtcbiAgcGF0aDogJy8nLFxuICBzZXBhcmF0b3I6ICdfJyxcbiAgaWZyYW1lOiB0cnVlLFxuICBoaWdobGlnaHQ6ICcqKiogXFxcXG4gXFxcXG4gPiBbIXF1b3RlXSBsb2NhdGlvbiBcXFxcbiAqaGlnaGxpZ2h0KiBcXFxcbiBcXFxcbicsXG4gIG5vdGU6ICcqKk5vdGUqKiBcXFxcbiA+IG5vdGUgXFxcXG4gXFxcXG4nLFxufVxuXG5leHBvcnQgY2xhc3MgS2luZGxlU2V0dGluZ3MgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogS2luZGxlQ3N2UGx1Z2luKSB7XG4gICAgc3VwZXIoYXBwLCBwbHVnaW4pXG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW5cbiAgfVxuXG4gIGRpc3BsYXkoKTogdm9pZCB7XG4gICAgbGV0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG5cbiAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnU2V0dGluZ3M6IEtpbmRsZSBDU1YgQ29udmVydGVyJyB9KTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ1BhdGggZm9yIHNhdmluZycpXG4gICAgICAuc2V0RGVzYygnVGhpcyBpcyB0aGUgcGF0aCB3ZXJlIHlvdXIgbm90ZXMgd2lsbCBiZSBzYXZlZC4nKVxuICAgICAgLmFkZERyb3Bkb3duKChkcm9wZG93bikgPT4ge1xuICAgICAgICBsZXQgZm9sZGVycyA9IFtdXG4gICAgICAgIGZvciAobGV0IGZpbGUgb2YgdGhpcy5hcHAudmF1bHQuZ2V0QWxsTG9hZGVkRmlsZXMoKSkge1xuICAgICAgICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZvbGRlcikge1xuICAgICAgICAgICAgZm9sZGVycy5wdXNoKGZpbGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZvbGRlcnMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICBkcm9wZG93bi5hZGRPcHRpb24odmFsdWVbJ3BhdGgnXSwgdmFsdWVbJ3BhdGgnXSk7XG4gICAgICAgIH0pXG5cbiAgICAgICAgZHJvcGRvd25cbiAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnBhdGgpXG4gICAgICAgIC5vbkNoYW5nZShhc3luYyB2YWx1ZSA9PiB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucGF0aCA9IHZhbHVlO1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KVxuICAgICAgfSlcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ1NlcGFyYXRvcicpXG4gICAgICAuc2V0RGVzYygnVGhpcyBpcyBob3cgdGhlIGZpbGUgbmFtZSB3aWxsIGJlIGZvcm1hdHRlZC4gRXhhbXBsZTogXCJUaXRsZSBvZiBteSBib29rXCIgaXMgZ29pbmcgdG8gYmUgXCJUaXRsZV9vZl9teV9ib29rXCIuJylcbiAgICAgIC5hZGRUZXh0KHRleHQgPT5cbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcignRGVmYXVsdCBpcyBcIl9cIicpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnNlcGFyYXRvcilcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgdmFsdWUgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2VwYXJhdG9yID0gdmFsdWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9KSlcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ1Nob3cgaWZyYW1lJylcbiAgICAgIC5zZXREZXNjKCdTaG93cyBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIG9mIHlvdXIgS2luZGxlIGJvb2suJylcbiAgICAgIC5hZGRUb2dnbGUodGV4dCA9PlxuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmlmcmFtZSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgdmFsdWUgPT4ge1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuaWZyYW1lID0gdmFsdWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICB9KSlcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoJ0hpZ2hsaWdodCcpXG4gICAgICAuc2V0RGVzYyhgVGhpcyByZXByZXNlbnRzIGhvdyB0aGUgaGlnaGxpZ2h0IHdpbGwgYmUgZm9ybWF0dGVkLiBEZWZhdWx0OiAke0RFRkFVTFRfU0VUVElOR1NbJ2hpZ2hsaWdodCddfWApXG4gICAgICAuYWRkVGV4dCh0ZXh0ID0+XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuaGlnaGxpZ2h0KVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyB2YWx1ZSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5oaWdobGlnaHQgPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pKVxuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnTm90ZScpXG4gICAgICAuc2V0RGVzYyhgVGhpcyByZXByZXNlbnRzIGhvdyB0aGUgbm90ZSB3aWxsIGJlIGZvcm1hdHRlZC4gRGVmYXVsdDogJHtERUZBVUxUX1NFVFRJTkdTWydub3RlJ119YClcbiAgICAgIC5hZGRUZXh0KHRleHQgPT5cbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5ub3RlKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyB2YWx1ZSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5ub3RlID0gdmFsdWU7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgIH0pKVxuXG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gzJywgeyB0ZXh0OiAnU3VwcG9ydCBtZSEnIH0pO1xuXG4gICAgY29uc3QgZGl2ID0gdGhpcy5jb250YWluZXJFbC5jcmVhdGVEaXYoXCJjb2ZmZWVcIik7XG4gICAgZGl2LmNyZWF0ZUVsKFwiYVwiLCB7XG4gICAgICBocmVmOiBcImh0dHBzOi8vd3d3LmJ1eW1lYWNvZmZlZS5jb20vYWx2YXJvLmNhc1wiXG4gICAgfSkuY3JlYXRlRWwoXCJpbWdcIiwge1xuICAgICAgYXR0cjoge1xuICAgICAgICBzcmM6IFwiaHR0cHM6Ly9pbWcuYnV5bWVhY29mZmVlLmNvbS9idXR0b24tYXBpLz90ZXh0PUJ1eSBtZSBhIGNvZmZlZSZlbW9qaT1cdTI2MTUmc2x1Zz1hbHZhcm8uY2FzJmJ1dHRvbl9jb2xvdXI9RkZERDAwJmZvbnRfY29sb3VyPTAwMDAwMCZmb250X2ZhbWlseT1JbnRlciZvdXRsaW5lX2NvbG91cj0wMDAwMDAmY29mZmVlX2NvbG91cj1mZmZmZmZcIlxuICAgICAgfVxuICAgIH0pXG4gIH1cbn1cbiIsICJpbXBvcnQgeyBNb2RhbCB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IE5vdGljZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IHNldEljb24gfSBmcm9tICdvYnNpZGlhbic7XG5cbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTtcbmNvbnN0IHJlYWRsaW5lID0gcmVxdWlyZSgncmVhZGxpbmUnKTtcblxuZXhwb3J0IGNsYXNzIFJlYWRlciBleHRlbmRzIE1vZGFsIHtcbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHNldHRpbmdzKSB7XG4gICAgc3VwZXIoYXBwKVxuICAgIHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5nc1xuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIGxldCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnS2luZGxlIENTViB0byBPYnNpZGlhbicsIGNsczogJ2gtbW9kYWwnIH0pO1xuXG4gICAgY29uc3QgZGl2TWFpbiA9IGNvbnRlbnRFbC5jcmVhdGVEaXYoeyBjbHM6ICdtYWluLWRpdicgfSk7XG4gICAgY29uc3QgZGl2SWNvbiA9IGRpdk1haW4uY3JlYXRlRGl2KHsgY2xzOiAnZmlsZS11cC1kaXYnIH0pO1xuICAgIHNldEljb24oZGl2SWNvbiwgJ2ZpbGUtdXAnKTtcbiAgICBkaXZJY29uLmNyZWF0ZUVsKCdkaXYnLCB7IHRleHQ6ICdDaG9vc2UgeW91ciBmaWxlJywgY2xzOiAnZGl2LW1vZGFsJyB9KTtcbiAgICBkaXZJY29uLm9uY2xpY2sgPSBfdGhpcyA9PiB7XG4gICAgICB0aGlzLmNyZWF0ZUZpbGUoKTtcbiAgICB9XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGxldCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgfVxuXG4gIGNyZWF0ZUZpbGUoKSB7XG4gICAgbGV0IGlucHV0ID0gYWN0aXZlRG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICBpbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgIGlucHV0LmFjY2VwdCA9ICcuY3N2JztcbiAgICBpbnB1dC5vbmNoYW5nZSA9IF90aGlzID0+IHtcbiAgICAgIGNvbnN0IHN0cmVhbSA9IGZzLmNyZWF0ZVJlYWRTdHJlYW0oaW5wdXQuZmlsZXNbMF1bJ3BhdGgnXSk7XG4gICAgICBjb25zdCByZWFkZXIgPSByZWFkbGluZS5jcmVhdGVJbnRlcmZhY2UoeyBpbnB1dDogc3RyZWFtIH0pO1xuXG4gICAgICBsZXQgZGF0YSA9IFtdO1xuXG4gICAgICByZWFkZXIub24oJ2xpbmUnLCAocm93KSA9PiB7XG4gICAgICAgIGxldCBsaW5lID0gcm93LnNwbGl0KCcsJyk7XG5cbiAgICAgICAgbGV0IHJlc3VsdCA9IGxpbmUuc3BsaWNlKDAsIDMpO1xuICAgICAgICByZXN1bHQucHVzaChsaW5lLmpvaW4oJywnKSk7XG5cbiAgICAgICAgZGF0YS5wdXNoKHJlc3VsdCk7XG4gICAgICB9KVxuXG4gICAgICByZWFkZXIub24oJ2Nsb3NlJywgKCkgPT4ge1xuICAgICAgICBsZXQgbmFtZSA9IGRhdGFbMV1bMF0ucmVwbGFjZSgvWyZcXC9cXFxcIywrKCkkfiUuJ1wiOio/PD57fV0vZywgJycpO1xuICAgICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKC8gL2csIHRoaXMuc2V0dGluZ3Muc2VwYXJhdG9yKTtcblxuICAgICAgICBsZXQgbWFya2Rvd247XG5cbiAgICAgICAgaWYgKHRoaXMuc2V0dGluZ3MuaWZyYW1lID09IHRydWUpIHtcbiAgICAgICAgICBtYXJrZG93biA9IGBcXG48aWZyYW1lXG4gICAgICAgICAgXFwgaGVpZ2h0PTYwMHB4XG4gICAgICAgICAgXFwgd2lkdGg9MTAwJVxuICAgICAgICAgIFxcIHNyYz0ke2RhdGFbNF1bMF19PjwvaWZyYW1lPiBcXG5gXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWFya2Rvd24gPSBgJHtkYXRhWzBdWzBdLnJlcGxhY2UoL1wiL2csICcnKX0gYFxuICAgICAgICAgICAgICAgICAgKyAgYCR7ZGF0YVsxXVswXS5yZXBsYWNlKC9cIi9nLCAnJyl9IGBcbiAgICAgICAgICAgICAgICAgICsgIGAke2RhdGFbMl1bMF0ucmVwbGFjZSgvXCIvZywgJycpfSBcXG5gXG4gICAgICAgIH1cblxuICAgICAgICBmb3IobGV0IGk9ODsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAoZGF0YVtpXVswXSA9PSAnXCJOb3RlXCInKSB7XG4gICAgICAgICAgICBsZXQgbm90ZSA9IHRoaXMuc2V0dGluZ3Mubm90ZS5yZXBsYWNlKCdub3RlJywgZGF0YVtpXVszXS5yZXBsYWNlKC9cIi9nLCAnJykpO1xuICAgICAgICAgICAgbm90ZSA9IG5vdGUucmVwbGFjZSgvXFxcXG4vZywgJ1xcbicpO1xuICAgICAgICAgICAgbWFya2Rvd24gKz0gbm90ZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGV0IGhpZ2hsaWdodCA9IHRoaXMuc2V0dGluZ3MuaGlnaGxpZ2h0LnJlcGxhY2UoJ2hpZ2hsaWdodCcsIGRhdGFbaV1bM10pO1xuICAgICAgICAgICAgaGlnaGxpZ2h0ID0gaGlnaGxpZ2h0LnJlcGxhY2UoL1xcXFxuL2csICdcXG4nKTtcbiAgICAgICAgICAgIGhpZ2hsaWdodCA9IGhpZ2hsaWdodC5yZXBsYWNlKCdsb2NhdGlvbicsIGRhdGFbaV1bMV0ucmVwbGFjZSgvXCIvZywgJycpKTtcbiAgICAgICAgICAgIG1hcmtkb3duICs9IGhpZ2hsaWdodDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmFwcC52YXVsdC5jcmVhdGUoYCR7dGhpcy5zZXR0aW5ncy5wYXRofS8ke25hbWV9Lm1kYCwgbWFya2Rvd24pXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICBuZXcgTm90aWNlKGBZb3VyIG5vdGVzIHdlcmUgc3VjY2VzZnVsbHkgY3JlYXRlZC4gXFxcbiAgICAgICAgICAgICAgICAgICAgIFBhdGg6ICR7dGhpcy5zZXR0aW5ncy5wYXRofWApO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgbmV3IE5vdGljZSgnRmlsZSBhbHJlYWR5IGV4aXN0cy4gUGxlYXNlIGRlbGV0ZSBhbmQgdHJ5IGFnYWluLicpO1xuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9XG4gICAgaW5wdXQuY2xpY2soKTtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cbn1cblxuIl0sCiAgIm1hcHBpbmdz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
